var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?n(a):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Dire;!function(e){e[e.up=0]="up",e[e.down=1]="down",e[e.left=2]="left",e[e.right=3]="right"}(Dire||(Dire={}));var Egg=function(e){function t(t){switch(e.call(this),this.type=t,t){case"eff_speedup":var i=RES.getRes("egg_json"),n=RES.getRes("egg_png"),a=new egret.MovieClipDataFactory(i,n),s=new egret.MovieClip(a.generateMovieClipData("egg"));s.scaleX=.5,s.x=200,s.scaleY=.5,this.addChild(s),s.play(-1);break;case"eff_speeddown":var r=RES.getRes("upspeed_json"),o=RES.getRes("upspeed_png"),a=new egret.MovieClipDataFactory(r,o),h=new egret.MovieClip(a.generateMovieClipData("upspeed"));h.scaleX=.5,h.scaleY=.5,this.addChild(h),h.play(-1);break;case"eff_reverse":var c=RES.getRes("downspeed_json"),g=RES.getRes("downspeed_png"),a=new egret.MovieClipDataFactory(c,g),l=new egret.MovieClip(a.generateMovieClipData("downspeed"));l.scaleX=.5,l.scaleY=.5,this.addChild(l),l.play(-1);break;default:var d=this.getRect();this.addChild(d)}this.width=20,this.height=20}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.getRect=function(){var e=new eui.Rect;return e.fillColor=parseInt("0x"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)),e.width=20,e.height=20,e},i(a,"Type",function(){return this.type},function(e){this.type=e}),t.EFF_SPEEDUP="eff_speedup",t.EFF_SPEEDDOWN="eff_speeddown",t.EFF_REVERSE="eff_reverse",t}(egret.Sprite);egret.registerClass(Egg,"Egg");var GameData=function(){function e(){this._totalScore=0,this._level=1,this.levelValue=0,this._speed=0,this._time=0}var t=__define,i=e,n=i.prototype;return t(e,"instance",function(){return null==e._instance&&(e._instance=new e),e._instance}),t(n,"time",function(){return this._time},function(e){this._time=e}),n.getSpeed=function(){return this._speed},n.getTotalScore=function(){return this._totalScore},n.getLevel=function(){return this._level},n.refrushScore=function(t){return void 0===t&&(t=e.singleScore),0==t?(this._totalScore=0,this._level=1,this._level):(this._totalScore+=t,this.checkLevel())},n.checkLevel=function(){return this.levelValue=parseInt(window.log2(this._totalScore/e.baseScore)),this.levelValue>this._level&&this._level++,this._speed=e.startSpeed/this._level,this._level},n.initData=function(){this._totalScore=0,this._level=1,this._time=0},e.singleScore=5,e.baseScore=2,e.startSpeed=500,e}();egret.registerClass(GameData,"GameData");var MapData=function(e){function t(t,i,n,a,s,r){e.call(this),this._eggArr=[],this.wallArr=[],this._eggArr=[],this.x=n,this.y=a,this.width=s,this.height=r,this.mapData=[];for(var o=0;t>o;o++){this.mapData[o]=[];for(var h=0;i>h;h++)this.mapData[o][h]=[]}}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.getMapData=function(){return this.mapData},a.setEntity=function(e,t,i){this.mapData[e][t].push(i)},a.drawGrid=function(){var e=this.width/20,t=this.height/20,i=new egret.Shape;i.width=this.width,i.height=this.height,i.graphics.lineStyle(1);for(var n=0;e>=n;n++){i.graphics.moveTo(i.x+20*n,i.y),i.graphics.lineTo(i.x+20*n,i.y+this.height);for(var a=0;t>=a;a++)i.graphics.moveTo(i.x,i.y+20*a),i.graphics.lineTo(i.x+this.width,i.y+20*a)}i.graphics.endFill(),this.addChildAt(i,0)},a.setSnake=function(e){this.snake=e,this.addChildAt(e,this.numChildren-1)},a.setEgg=function(e){this.egg&&this.egg.x==e.x&&this.egg.y==e.y||(this.egg=e,this.addChildAt(e,this.numChildren-1),this._eggArr.push(e))},a.setWall=function(e){this.wallArr.push(e)},i(a,"eggArr",function(){return this._eggArr}),a.recycleEgg=function(e){e.parent&&e.parent.removeChild(e),this._eggArr.splice(this._eggArr.indexOf(e),1)},t}(egret.DisplayObjectContainer);egret.registerClass(MapData,"MapData");var Snake=function(e){function t(){e.call(this),this.direction=Dire.up,this.changeDirePoint=new Array,this.SnakeSprite=new Array}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.initSnake=function(e,t,i){var n=new SnakeEntity(i);return n.name=i,this.SnakeSprite.push(n),n.x=20*e,n.y=20*t,this.addChild(n),n},a.addEntity=function(){var e=this.SnakeTail,t=e.x/20,i=e.y/20,n=this.initSnake(t,i,"tail_png");switch(n.changeDire(e.getDirection()),e.getDirection()){case Dire.up:i++;break;case Dire.down:i--;break;case Dire.left:t++;break;case Dire.right:t--}e.changeType("body_png")},i(a,"SnakeHead",function(){return this.SnakeSprite[0]}),i(a,"SnakeTail",function(){return this.SnakeSprite[this.SnakeSprite.length-1]}),i(a,"SnakeBody",function(){return this.SnakeSprite.slice(4,this.SnakeSprite.length)}),a.run=function(){var e=this.SnakeSprite[0];e.changeDire(this.direction);var t=this.SnakeSprite[this.SnakeSprite.length-1],i=this.SnakeSprite.splice(this.SnakeSprite.length-2,1);this.SnakeSprite.splice(1,0,i[0]),this.direction!=e.getDirection()&&(e.changeDire(this.direction),this.changeDirePoint[0]=[e.x,e.y]),this.commonChange(this.direction,e,i[0],t)},a.commonChange=function(e,t,i,n){n.x=i.x,n.y=i.y,this.changeDirePoint.length>0&&this.changeDirePoint[0][0]==n.x&&this.changeDirePoint[0][1]==n.y&&n.getDirection()!=this.direction&&n.changeDire(e),i.getDirection()!=e&&i.changeDire(e),n.getDirection()!=i.getDirection()&&n.changeDire(e),i.x=t.x,i.y=t.y,e==Dire.left?(t.x-=20,t.y=t.y):e==Dire.up?(t.x=t.x,t.y-=20):e==Dire.down?(t.x=t.x,t.y+=20):(t.x+=20,t.y=t.y)},a.changeDire=function(e,t){this.direction=e},t}(egret.Sprite);egret.registerClass(Snake,"Snake");var Snakebase=function(e){function t(t){e.call(this),this.direction=Dire.up,this.bitmap=Utils.createBitmapByName(t),this.addChild(this.bitmap)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.changeType=function(e){Utils.updateBitmapByName(this.bitmap,e)},n.getDirection=function(){return this.direction},n.changeDire=function(e){return this.correctDire(e),this.direction=e},n.correctDire=function(e){this.direction!=e&&(this.direction=e,e==Dire.left?(this.bitmap.anchorOffsetX=20,this.bitmap.anchorOffsetY=0,this.bitmap.rotation=-90):e==Dire.up?(this.bitmap.anchorOffsetX=0,this.bitmap.anchorOffsetY=0,this.bitmap.rotation=0):e==Dire.down?(this.bitmap.anchorOffsetX=20,this.bitmap.anchorOffsetY=20,this.bitmap.rotation=180):(this.bitmap.anchorOffsetX=0,this.bitmap.anchorOffsetY=20,this.bitmap.rotation=90))},t}(egret.Sprite);egret.registerClass(Snakebase,"Snakebase",["ISnake"]);var SnakeEntity=function(e){function t(t){e.call(this,t)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.getDirection=function(){return e.prototype.getDirection.call(this)},n.changeDire=function(t){return e.prototype.changeDire.call(this,t)},n.correctDire=function(t){e.prototype.correctDire.call(this,t)},t}(Snakebase);egret.registerClass(SnakeEntity,"SnakeEntity");var LoadEvent=function(e){function t(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(t,e);var i=(__define,t);i.prototype;return t}(RES.ResourceEvent);egret.registerClass(LoadEvent,"LoadEvent");var MainEvent=function(e){function t(t,i,n,a){void 0===i&&(i=""),void 0===n&&(n=!1),void 0===a&&(a=!1),e.call(this,t,n,a),this._resName="",this._resName=i}__extends(t,e);var i=__define,n=t,a=n.prototype;return i(a,"resName",function(){return this._resName}),t.OPENLOADBAR="loadbar",t.REMOVE="remove",t.LOADCOMP="loadcomp",t}(egret.Event);egret.registerClass(MainEvent,"MainEvent");var HierarchyManager=function(e){function t(){e.call(this),this.stageW=800,this.stageH=480,this.resAny=[],this.UIHierarchy=new egret.DisplayObjectContainer,this.TOPHierarchy=new egret.DisplayObjectContainer,this.EFFECTHierarchy=new egret.DisplayObjectContainer}__extends(t,e);var i=(__define,t),n=i.prototype;return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},n.init=function(){Main.instance.addChild(this.UIHierarchy),Main.instance.addChild(this.TOPHierarchy),Main.instance.addChild(this.EFFECTHierarchy)},n.delresAny=function(){for(var e=0;e<this.resAny.length;e++)t.instance.UIHierarchy.removeChild(this.resAny[e]),this.resAny[e]=null},t}(egret.DisplayObjectContainer);egret.registerClass(HierarchyManager,"HierarchyManager");var LoadBar=function(e){function t(){e.call(this),this.initLoadBar()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.initLoadBar=function(){},t}(HierarchyManager);egret.registerClass(LoadBar,"LoadBar");var LoadManager=function(e){function t(){e.call(this),this.isInit=!0,this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,this._configs=new Array}__extends(t,e);var i=(__define,t),n=i.prototype;return n.addConfig=function(e,t){this._configs.push([e,t])},n.loadConfig=function(){this.loadNextConfig()},n.loadNextConfig=function(){if(0==this._configs.length)return void(this.isInit&&(Main.instance.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),Main.instance.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.isInit=!1,this.onConfigComplete()));var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},n.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},t.getInstance=function(){if(null==t.instance){var e=new t;t.instance=e}return t.instance},n.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",Main.instance.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload"),RES.loadGroup("loading",1)},n.onResourceProgress=function(e){this.loadevent=new LoadEvent(LoadEvent.GROUP_PROGRESS),this.loadevent.groupName=e.groupName,this.loadevent.itemsLoaded=e.itemsLoaded,this.loadevent.itemsTotal=e.itemsTotal,this.dispatchEvent(this.loadevent),this.loadevent=null},n.onThemeLoadComplete=function(){this.loadevent=new LoadEvent(eui.UIEvent.COMPLETE),this.dispatchEvent(this.loadevent),this.loadevent=null},n.onResourceLoadComplete=function(e){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.loadevent=new LoadEvent(LoadEvent.GROUP_COMPLETE),this.loadevent.groupName=e.groupName,this.dispatchEvent(this.loadevent),this.loadevent=null},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.load=function(e,t){void 0===t&&(t=0),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e,t)},t}(egret.EventDispatcher);egret.registerClass(LoadManager,"LoadManager");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.views=[],this.resGroup=[],t.instance=this,HierarchyManager.getInstance(),HierarchyManager.instance.init(),this.panelManager=PanelManager.getInstance(),SoundManager.getInstance(),t.instance.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){LoadManager.getInstance(),LoadManager.instance.addEventListener(LoadEvent.GROUP_COMPLETE,this.loadComp,t.instance),LoadManager.instance.addEventListener(eui.UIEvent.COMPLETE,this.loadEuiComp,t.instance),LoadManager.instance.addEventListener(LoadEvent.GROUP_PROGRESS,this.loadprogress,t.instance),LoadManager.getInstance().addConfig("resource/default.res.json","resource/"),LoadManager.getInstance().addConfig("resource/myResource.json","resource/"),LoadManager.getInstance().loadConfig(),this.addEventListener(MainEvent.REMOVE,this.removeLast,this),this.addEventListener(MainEvent.OPENLOADBAR,this.createLoadBar,this),this.addEventListener(MainEvent.LOADCOMP,this.addSence,this)},n.loadprogress=function(e){var t=e.groupName;switch(t){case"preload":break;case"assets":this.loadScene.setProgress(e.itemsLoaded,e.itemsTotal)}},n.loadEuiComp=function(){LoadManager.instance.isThemeLoadEnd=!0,this.createScene()},n.loadComp=function(e){var t=e.groupName;switch(t){case"preload":break;case"loading":this.loadingView=null,LoadManager.instance.isResourceLoadEnd=!0,this.createScene();break;case"assets":this.loadScene.loadComp("StartScene");break;default:console.log("呵呵哒！根本没有这个资源呀！")}},n.createLoadBar=function(e){this.resName=e.resName,this.loadBar=new LoadBar,this.addChild(this.loadBar)},n.removeLast=function(e){LoadManager.instance.load(this.resName);var t=this.views.shift();t.destroy()},n.addSence=function(e){var t=egret.getDefinitionByName(this.resGroup[e.resName]),i=new t;HierarchyManager.instance.UIHierarchy.addChild(i),this.views.push(i)},n.createScene=function(){LoadManager.instance.isThemeLoadEnd&&LoadManager.instance.isResourceLoadEnd&&(this.loadScene=new LoadScene,this.loadScene.name="loadScene",t.instance.views.loadScene=this.loadScene,HierarchyManager.instance.UIHierarchy.addChild(this.loadScene))},n.init=function(e){var t;try{var i=egret.getDefinitionByName(e);t=new i}catch(n){alert(n)}t.name=e,HierarchyManager.instance.UIHierarchy.addChild(t)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var EggManager=function(){function e(){this._events={},this.addEventListener("create",this.create,this),this.addEventListener("dispose",this.dispose,this)}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},i.create=function(){this.dispatchEvent("gotoScene",new Egg("egg"))},i.dispose=function(e){return e.length<=0?void console.info("没有需要消毁的鸡蛋"):void(e[0]=null)},i.addEventListener=function(e,t,i){return null!=this._events[e]?void console.info("不允许对同一个事件监听两遍,error event name:",e):void(this._events[e]={callback:t,thisObj:i})},i.dispatchEvent=function(e,t){if(null==this._events[e])return void console.info("不允许对一个空事件进行派发,error event name:",e);var i=this._events[e];t?i.callback.apply(i.thisObj,[t]):i.callback.call(i.thisObj)},i.disposeAllEvents=function(){for(var e in this._events)"create"!=e&&delete this._events[e]},e}();egret.registerClass(EggManager,"EggManager");var PanelManager=function(){function e(){this.panelArray=[]}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return(e.instance=null)&&(e.instance=new e),e.instance},i.showPanel=function(e){var t=egret.getDefinitionByName(e),i=new t;HierarchyManager.instance.TOPHierarchy.addChild(i),this.panelArray[e]=i},i.disposePanel=function(e){HierarchyManager.instance.TOPHierarchy.removeChild(this.panelArray[e]),this.panelArray[e]=null},e}();egret.registerClass(PanelManager,"PanelManager");var SoundManager=function(e){function t(){e.call(this),this._position=0}__extends(t,e);var i=__define,n=t,a=n.prototype;return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},i(a,"bgMusic",function(){return this._bg_music||(this._bg_music=RES.getRes("Music_mp3")),this._bg_music}),t.playBtnTouch=function(){this.playSound("btntouch_mp3")},t.playEatEgg=function(){this.playSound("yes_mp3")},t.gameover=function(){this.playSound("gameover_mp3")},t.playSound=function(e){var t=RES.getRes(e);t.play(this.position,1)},a.play=function(){this._bg_channel=this.bgMusic.play(this._position,-1)},a.stop=function(){this._bg_music&&(this._position=this._bg_channel.position,this._bg_channel.stop())},t.position=0,t}(egret.DisplayObjectContainer);egret.registerClass(SoundManager,"SoundManager");var TimeManager=function(){function e(){}var t=__define,i=e,n=i.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},n.doGameTick=function(){this._curResult&&this._curResult.time++},t(n,"curResult",function(){return this._curResult}),t(n,"curGameTime",function(){return this._curResult?this._curResult.time:(this._curResult=GameData.instance,0)}),e}();egret.registerClass(TimeManager,"TimeManager");var GameOver=function(e){function t(){e.call(this),this.skinName="resource/my_skins/gameoverSkin.exml",this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnMenu,this),this.again.addEventListener(egret.TouchEvent.TOUCH_TAP,this.againGame,this),this.updateView(),Utils.sunturn(this.sc4wheel1),Utils.sunturn(this.sc4wheel2,5e3,!0)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.updateView=function(){this.scoreLabel.text=GameData.instance.getTotalScore()+"",this.chenghaoLabel.text=this.getChenghao();var e=Utils.getNumberData("scoreMax");GameData.instance.getTotalScore()>e?(this.titleLabel.text="新纪录！",Utils.saveData("scoreMax",GameData.instance.getTotalScore())):this.titleLabel.text="得分",this.scoreMaxLabel.text=""+Utils.getNumberData("scoreMax")},n.getChenghao=function(){return GameData.instance.getLevel()<5?"幼稚园小班":GameData.instance.getTotalScore()<10?"幼稚园中班":GameData.instance.getTotalScore()<20?"幼稚园大班":GameData.instance.getTotalScore()<30?"小学":GameData.instance.getTotalScore()<40?"初中":GameData.instance.getTotalScore()<50?"高中":GameData.instance.getTotalScore()<60?"中专":GameData.instance.getTotalScore()<70?"大专":GameData.instance.getTotalScore()<80?"大学":GameData.instance.getTotalScore()<90?"研究生":GameData.instance.getTotalScore()<100?"博士":"走火入魔"},n.returnMenu=function(){var e=new StartScene;HierarchyManager.instance.UIHierarchy.addChild(e),EggManager.getInstance().disposeAllEvents(),Main.instance.views.startScene=e,HierarchyManager.instance.UIHierarchy.removeChild(this),SoundManager.playBtnTouch()},n.againGame=function(){var e=new GameScene;HierarchyManager.instance.UIHierarchy.addChild(e),EggManager.getInstance().disposeAllEvents(),Main.instance.views.gameScene=e,HierarchyManager.instance.UIHierarchy.removeChild(this),SoundManager.playBtnTouch()},t}(eui.Component);egret.registerClass(GameOver,"GameOver");var GameScene=function(e){function t(){e.call(this),this.isReverse=!1,this.isEff=!1,this.skinName="resource/my_skins/gameUiSkin.exml",this.snake=new Snake,this.upbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeDirection,this),this.downbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeDirection,this),this.leftbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeDirection,this),this.rightbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeDirection,this),this._timer=new egret.Timer(1e3),this._timer.addEventListener(egret.TimerEvent.TIMER,this._onTimer,this),this._timer.start(),egret.callLater(this.addToStage,this),document.addEventListener("keydown",this.keyDown.bind(this))}__extends(t,e);var i=(__define,t),n=i.prototype;return n._onTimer=function(e){TimeManager.getInstance().doGameTick(),this._updateTime()},n._updateTime=function(){this.timesInfo&&(this.timesInfo.text=TimeUtils.getTimeStr(TimeManager.getInstance().curGameTime))},n.keyDown=function(e){var t=new egret.TouchEvent("touchTap");switch(e.keyCode){case 37:t.$target=this.leftbtn,this.leftbtn.dispatchEvent(t);break;case 39:t.$target=this.rightbtn,this.rightbtn.dispatchEvent(t);break;case 38:t.$target=this.upbtn,this.upbtn.dispatchEvent(t);break;case 40:t.$target=this.downbtn,this.downbtn.dispatchEvent(t)}},n.changeDirection=function(e){var t=e.target;if(egret.callLater(function(){t.selected=!1},this),!(this.snake.SnakeHead.getDirection()==Dire.up&&e.target==this.downbtn||this.snake.SnakeHead.getDirection()==Dire.down&&e.target==this.upbtn||this.snake.SnakeHead.getDirection()==Dire.left&&e.target==this.rightbtn||this.snake.SnakeHead.getDirection()==Dire.right&&e.target==this.leftbtn))switch(e.target){case this.upbtn:this.snake.changeDire(this.isReverse?Dire.down:Dire.up,this.snake.SnakeHead),SoundManager.playBtnTouch();break;case this.downbtn:this.snake.changeDire(this.isReverse?Dire.up:Dire.down,this.snake.SnakeHead),SoundManager.playBtnTouch();break;case this.leftbtn:this.snake.changeDire(this.isReverse?Dire.right:Dire.left,this.snake.SnakeHead),SoundManager.playBtnTouch();break;case this.rightbtn:this.snake.changeDire(this.isReverse?Dire.left:Dire.right,this.snake.SnakeHead),SoundManager.playBtnTouch();break;default:console.log("你按下了啥键！")}},n.addToStage=function(){this.mapWidth=this.gameMap.width,this.mapHeight=this.gameMap.height,this.xPointNumber=this.mapWidth/20,this.yPointNumber=this.mapHeight/20,this.mapData=new MapData(this.xPointNumber,this.yPointNumber,this.gameMap.x,this.gameMap.y,this.gameMap.width,this.gameMap.height),this.addChild(this.mapData),this.mapData.setSnake(this.snake),this.mapData.setWall(this.wall1),this.mapData.setWall(this.wall2),this.mapData.setWall(this.wall3),this.mapData.setWall(this.wall4);var e=13,t=17,i=this.snake.initSnake(e,t,"head_png");this.mapData.setEntity(e,t,i);var i=this.snake.initSnake(e,t+1,"body_png");this.mapData.setEntity(e,t+1,i);var i=this.snake.initSnake(e,t+2,"body_png");this.mapData.setEntity(e,t+2,i);var i=this.snake.initSnake(e,t+3,"tail_png");this.mapData.setEntity(e,t+3,i),GameConfig.curPanel=this,GameData.instance.initData(),this.mapData.drawGrid(),this.delay=600,this.timer=new egret.Timer(this.delay),this.timer.addEventListener(egret.TimerEvent.TIMER,this.snakeRun,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.start(),EggManager.getInstance().addEventListener("gotoScene",this.gotoScene,this),EggManager.getInstance().dispatchEvent("create")},n.gotoScene=function(e){e.x=20*Math.round(Math.random()*(this.xPointNumber-2-2)+2),e.y=20*Math.round(Math.random()*(this.yPointNumber-2-2)+2),this.mapData.setEgg(e)},n.timerComFunc=function(e){console.log("ss"),this.timer.reset(),this.timer.start()},n.snakeRun=function(e){return this.isEff&&TipsUtils.shakeScreen(2),this.snake.run(),this.eatEgg(),this.checkIsOver(),!0},n._clear=function(){this.timer.stop(),this.timer.reset(),GameData.instance.initData(),this.isReverse=!1,this.isEff=!1},n.eatEgg=function(){for(var e=0;e<this.mapData.eggArr.length;e++){var t=this.mapData.eggArr[e];if(this.snake.SnakeHead.x==t.x&&this.snake.SnakeHead.y==t.y)switch(this.tipsInfo.text="耶~顺利度过~~",this.isReverse=!1,this.isEff=!1,GameData.instance.refrushScore(),this.score.text=""+GameData.instance.getTotalScore(),this.speedInfo.text!=""+GameData.instance.getLevel()&&(this.speedInfo.text=""+GameData.instance.getLevel(),TipsUtils.shakeScreen(1),TipsUtils.showTipsLeftOrRight("Congratulation!!又过关啦~~~")),this.timer.delay=GameData.instance.getSpeed(),this.randegg(),SoundManager.playEatEgg(),this.mapData.recycleEgg(t),this.snake.addEntity(),t.Type){case Egg.EFF_SPEEDUP:this.timer.delay=GameData.instance.getSpeed()/2,this.tipsInfo.text="小心！现在加速状态哦！！！",this.isEff=!0;break;case Egg.EFF_SPEEDDOWN:this.timer.delay=2*GameData.instance.getSpeed(),this.tipsInfo.text="小心！现在减速状态哦！！！",this.isEff=!0;break;case Egg.EFF_REVERSE:this.isReverse=!0,this.tipsInfo.text="小心！ 现在是反向状态哦！！！",this.isEff=!0}}},n.randegg=function(){EggManager.getInstance().dispatchEvent("gotoScene",new Egg("rect"));for(var e=Math.floor(Math.random()*GameData.instance.getLevel()),t=0;e>t;t++)EggManager.getInstance().dispatchEvent("gotoScene",new Egg(this.getRandomEff()))},n.getRandomEff=function(){var e=Egg.EFF_SPEEDUP;switch(Math.floor(3*Math.random()+1)){case 1:e=Egg.EFF_SPEEDUP;break;case 2:e=Egg.EFF_SPEEDDOWN;break;case 3:e=Egg.EFF_REVERSE}return e},n.checkIsOver=function(){if(this.snake.SnakeHead.x<0||this.snake.SnakeHead.x>520||this.snake.SnakeHead.y<0||this.snake.SnakeHead.y>400){console.log("【游戏结束】,撞墙啦");var e=new GameOver;HierarchyManager.instance.UIHierarchy.addChild(e),Main.instance.views.gameScene=e,HierarchyManager.instance.UIHierarchy.removeChild(this),SoundManager.getInstance().stop(),SoundManager.gameover(),this._clear(),this._timer&&(this._timer.addEventListener(egret.TimerEvent.TIMER,this._onTimer,this),this._timer.stop())}for(var t=0;t<this.snake.SnakeBody.length;t++)if(this.snake.SnakeHead.x==this.snake.SnakeBody[t].x&&this.snake.SnakeHead.y==this.snake.SnakeBody[t].y){console.log("撞到自己");var e=new GameOver;HierarchyManager.instance.UIHierarchy.addChild(e),Main.instance.views.gameScene=e,HierarchyManager.instance.UIHierarchy.removeChild(this),SoundManager.getInstance().stop(),SoundManager.gameover(),this._clear(),this._timer&&(this._timer.addEventListener(egret.TimerEvent.TIMER,this._onTimer,this),this._timer.stop())}},t}(eui.Component);egret.registerClass(GameScene,"GameScene");var LoadScene=function(e){function t(){e.call(this),this.skinName="resource/my_skins/loadingSkin.exml",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),egret.callLater(this.addMcAndLoad,this)},n.addMcAndLoad=function(){var e=this.loadingbarbg.y,t=this.loadingbarbg.x;this.loadingbarbgWidth=this.loadingbarbg.width;var i=RES.getRes("snake_json"),n=RES.getRes("snake_png");this.mcDataFactory=new egret.MovieClipDataFactory(i,n),this.mc=new egret.MovieClip(this.mcDataFactory.generateMovieClipData("snake")),this.mc.y=e-2*this.mc.height,this.mc.x=t,this.addChild(this.mc),this.mc.play(-1),LoadManager.getInstance().load("assets",3)},n.setProgress=function(e,t){this.loadingbarpic.width=e/t*this.loadingbarbgWidth,this.mc.x=e/t*this.loadingbarbgWidth*1.12},n.loadComp=function(e){Main.instance.init(e),this.dispose()},n.dispose=function(){HierarchyManager.instance.UIHierarchy.removeChild(Main.instance.views.loadScene),Main.instance.views.loadScene=null},t}(eui.Component);egret.registerClass(LoadScene,"LoadScene");var StartScene=function(e){function t(){e.call(this),this.isOpenPanel=!1;this.skinName="resource/my_skins/StartSkin.exml",this.setting.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchSettingAndHelp,this),this.help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchSettingAndHelp,this),this.rank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchRank,this),this.startGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchStart,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.touchSettingAndHelp=function(e){SoundManager.playBtnTouch();var t=e.target==this.setting?"setting":"help";this.isOpenPanel?(this.ipanel.close(),this.isOpenPanel=!1,this.ipanel.closePanel(),this.ipanel.Type!=t&&(this.ipanel=new MyPanel(t),this.isOpenPanel=!0,this.ipanel.addEventListener("close",this.panelClose,this),this.addChild(this.ipanel))):(this.ipanel=new MyPanel(t),this.isOpenPanel=!0,this.ipanel.addEventListener("close",this.panelClose,this),this.addChild(this.ipanel))},n.panelClose=function(e){"setting"==e.data?(this.setting.selected=!1,this.isOpenPanel=!1):(this.help.selected=!1,this.isOpenPanel=!1)},n.touchRank=function(e){this.rankpanel=new RankPanel,this.addChild(this.rankpanel),SoundManager.playBtnTouch()},n.touchStart=function(){var e=new GameScene;HierarchyManager.instance.UIHierarchy.addChild(e),Main.instance.views.gameScene=e,HierarchyManager.instance.UIHierarchy.removeChild(this),SoundManager.playBtnTouch()},t}(eui.Component);egret.registerClass(StartScene,"StartScene");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function a(e){t.call(n,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var GameConfig;!function(e){function t(){return egret.MainContext.instance.stage}function i(){return egret.MainContext.instance.stage.stageWidth}function n(){return egret.MainContext.instance.stage.stageHeight}e.TextColors={white:16777215,milkWhite:16511407,grayWhite:13547170,yellow:16776960,lightYellow:16765813,orangeYellow:16750848,red:15799040,green:58624,blue:1742039,grayBlue:3101047,purple:15284466,pink:16724016,black:3026221,golden:16766720},e.LabelFontSize={littleSize:12,middleSize:18,normalSize:24,bigSize:36},e.curStage=t,e.curWidth=i,e.curHeight=n}(GameConfig||(GameConfig={}));var MyPanel=function(e){function t(t){switch(e.call(this),this.type=t,this.skinName="resource/my_skins/panel/myPanelSkin.exml",t){case"setting":this.music.addEventListener(egret.TouchEvent.TOUCH_TAP,this.musicSetting,this),this.effect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.effectSetting,this),this.panelText1.visible=!1,this.panelText2.visible=!1;break;case"help":this.music.visible=!1,this.effect.visible=!1,this.panelText1.text="       游戏简介：按方向键或按钮来控制游戏移动方向,每吃到一个道具或食物则加5分，吃到加速蛋则速度加快，吃到减速蛋则速度减慢，吃到反向道具，则蛇会按照玩家所按按钮的相反方向进行移动，碰到障碍物或自身则游戏结束。\n\n        游戏规则：玩家可以通过按钮或者键盘来对蛇进行操作。\n ",this.panelText2.text="作者：韩奕昕",this.panelText1.touchEnabled=!1,this.panelText2.touchEnabled=!1;break;default:console.log("并没有这种类型")}this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.panelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closePanel,this)}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.addToStage=function(){this.x=this.stage.stageWidth/2-this.width/2,this.y=this.stage.stageHeight/2-this.height/2},a.musicSetting=function(){console.log(this.music.selected),this.music.selected?SoundManager.getInstance().play():SoundManager.getInstance().stop()},a.effectSetting=function(){console.log(this.effect.selected)},a.closePanel=function(){this.dispatchEventWith("close",!1,this.type),this.close()},i(a,"Type",function(){return this.type}),t}(eui.Panel);egret.registerClass(MyPanel,"MyPanel");var RankPanel=function(e){function t(){e.call(this),this.skinName="resource/my_skins/panel/rankPanelSkin.exml";var t=new GameOver,i=t.scoreMaxLabel.text;this.score.text=i+"",this.panelText1.touchEnabled=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.panelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closePanel,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.addToStage=function(){this.x=this.stage.stageWidth/2-this.width/2,this.y=this.stage.stageHeight/2-this.height/2},n.closePanel=function(){this.dispatchEventWith("close",!1),this.close()},t}(eui.Panel);egret.registerClass(RankPanel,"RankPanel");var TimeUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.getTimeStr=function(t){var i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),a=t-3600*i-60*n;return e.fixNumStr(i,2)+":"+e.fixNumStr(n,2)+":"+e.fixNumStr(a,2)},e.fixNumStr=function(e,t){if(0>=t)return e.toString();if(e>=Math.pow(10,t))return"error";for(var i="";t>0;){var n=Math.floor(e/Math.pow(10,t-1));i+=n.toString(),e-=n*Math.pow(10,t-1),t--}return i},e}();egret.registerClass(TimeUtils,"TimeUtils");var TipsUtils;!function(e){function t(e){void 0===e&&(e=1);var t=GameConfig.curPanel,i=40,n=t.x,a=t.y;1==e?(egret.Tween.get(t).to({x:t.x-10},i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20},i)},this,2*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x-20},i)},this,3*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20},i)},this,4*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:n},i)
},this,5*i)):(egret.Tween.get(t).to({x:t.x-10,y:t.y},i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20,y:t.y},i)},this,2*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x,y:t.y+15},i)},this,3*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x,y:t.y-20},i)},this,4*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x,y:t.y+10},i)},this,5*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:n,y:a},i)},this,6*i))}function i(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var i=new egret.TextField;i.size=24,i.y=GameConfig.curHeight()/2,t?i.textColor=GameConfig.TextColors.red:i.textColor=GameConfig.TextColors.green,i.alpha=0,i.text=e,i.strokeColor=0,i.x=GameConfig.curWidth()/2-i.width/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,HierarchyManager.instance.EFFECTHierarchy.contains(i)||HierarchyManager.instance.EFFECTHierarchy.addChild(i);var n=function(){HierarchyManager.instance.EFFECTHierarchy.contains(i)&&(HierarchyManager.instance.EFFECTHierarchy.removeChild(i),i=null)},a=function(){egret.Tween.get(i).to({alpha:0},500).call(n,this)};i.visible=!0,egret.Tween.get(i).to({y:i.y-120,alpha:1},800,egret.Ease.backOut).call(a,this)}function n(e,t,i){void 0===e&&(e=""),void 0===t&&(t=!1),void 0===i&&(i=!0);var n=new egret.TextField;n.size=24,n.y=GameConfig.curHeight()/2,t?n.textColor=GameConfig.TextColors.red:n.textColor=GameConfig.TextColors.green,n.alpha=0,n.text=e,n.strokeColor=0,i?n.x=-n.width:n.x=GameConfig.curWidth(),n.stroke=2,n.bold=!0,n.textAlign=egret.HorizontalAlign.CENTER,HierarchyManager.instance.EFFECTHierarchy.contains(n)||HierarchyManager.instance.EFFECTHierarchy.addChild(n),i?egret.Tween.get(n).to({x:GameConfig.curWidth()/2-n.width/2-50,alpha:1},300,egret.Ease.sineInOut):egret.Tween.get(n).to({x:GameConfig.curWidth()/2-n.width/2+50,alpha:1},300,egret.Ease.sineInOut),egret.setTimeout(function(){i?egret.Tween.get(n).to({x:n.x+100},1e3):egret.Tween.get(n).to({x:n.x-100},1e3)},this,300),egret.setTimeout(function(){i?egret.Tween.get(n).to({x:GameConfig.curWidth()},300,egret.Ease.sineIn):egret.Tween.get(n).to({x:-n.width},300,egret.Ease.sineIn)},this,1300),egret.setTimeout(function(){HierarchyManager.instance.EFFECTHierarchy.contains(n)&&(HierarchyManager.instance.EFFECTHierarchy.removeChild(n),n=null)},this,1600)}function a(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var i=new egret.TextField;i.size=24,i.y=GameConfig.curHeight()/2,t?i.textColor=GameConfig.TextColors.red:i.textColor=GameConfig.TextColors.green,i.alpha=0,i.text=e,i.strokeColor=0,i.x=GameConfig.curWidth()/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,HierarchyManager.instance.EFFECTHierarchy.contains(i)||HierarchyManager.instance.EFFECTHierarchy.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=0,i.scaleY=0;var n=function(){HierarchyManager.instance.EFFECTHierarchy.contains(i)&&(HierarchyManager.instance.EFFECTHierarchy.removeChild(i),i=null)};egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},200),egret.setTimeout(function(){egret.Tween.get(i).to({alpha:0},500).call(n,this)},this,1e3)}function s(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var i=new egret.TextField;i.size=24,i.y=GameConfig.curHeight()/2,t?i.textColor=GameConfig.TextColors.red:i.textColor=GameConfig.TextColors.green,i.alpha=0,i.text=e,i.strokeColor=0,i.x=GameConfig.curWidth()/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,HierarchyManager.instance.EFFECTHierarchy.contains(i)||HierarchyManager.instance.EFFECTHierarchy.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=4,i.scaleY=4;var n=function(){HierarchyManager.instance.EFFECTHierarchy.contains(i)&&(HierarchyManager.instance.EFFECTHierarchy.removeChild(i),i=null)};egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},200),egret.setTimeout(function(){egret.Tween.get(i).to({alpha:0},500).call(n,this)},this,1e3)}e.shakeScreen=t,e.showTipsDownToUp=i,e.showTipsLeftOrRight=n,e.showTipsFromCenter=a,e.showTipsBigToSmall=s}(TipsUtils||(TipsUtils={}));var Utils=function(){function e(){}var t=(__define,e);t.prototype;return e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.updateBitmapByName=function(e,t){var i=RES.getRes(t);return e.texture=i,e},e.saveData=function(e,t){egret.localStorage.setItem(e,t)},e.getNumberData=function(e){var t,i=egret.localStorage.getItem(e);return t=null==i?0:parseInt(i)},e.sunturn=function(e,t,i){void 0===t&&(t=5e3),void 0===i&&(i=!1);var n=e.x,a=e.y;e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=n+e.anchorOffsetX,e.y=a+e.anchorOffsetY,i?egret.Tween.get(e,{loop:!0}).to({rotation:-180},t/2).to({rotation:-360},t/2):egret.Tween.get(e,{loop:!0}).to({rotation:180},t/2).to({rotation:360},t/2)},e}();egret.registerClass(Utils,"Utils");